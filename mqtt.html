<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>MQTT Publisher</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.0.0/mqtt.min.js"></script>
</head>
<body>
    <div>
        <label for="topic">Topic:</label>
        <input id="topic" type="text" placeholder="Enter MQTT topic">
    </div>
    <div>
        <label for="message">Message:</label>
        <input id="message" type="text" placeholder="Enter message">
    </div>
    <button onclick="publishMessage()">Publish</button>
    <button onclick="subscribeMessage()">Subscribe</button>

    <script>
        const mqttOptions = {
          host: '14951d018b4a4ab6923ef058b3789020.s2.eu.hivemq.cloud',
          port: 8883,
          protocol: 'mqtts',
          username: 'ethindia-client',
          password: 'ethindia2023'
        };

       // const client = mqtt.connect(mqttOptions);

       const client = mqtt.connect('ws://broker.emqx.io:8083/mqtt', {
        username: 'ethindia-client',
          password: 'ethindia2023',
        });

        client.on('connect', () => {
            console.log('Connected to HiveMQ');
        });

        client.on('error', (error) => {
            console.error('MQTT Error:', error);
        });

        function publishMessage() {
            const topic = document.getElementById('topic').value;
            const message = document.getElementById('message').value;

            if (topic && message) {
                const resp= client.publish(topic, message);
                console.log("response after publishing is ",resp)
                console.log(`Published message to ${topic}: ${message}`);
            } else {
                console.error('Topic and message are required.');
            }
        }

        function subscribeMessage() {
          client.subscribe('ethindia', function (err) {
          if (!err) {
            console.log('Subscribed to my/test/topic');
          }
        });
        }

        client.on('message', function (topic, message) {
    // Called each time a message is received
    console.log('Received message:', topic, message.toString());
  });

    </script>
</body>
</html>
